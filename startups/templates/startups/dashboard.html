{% extends 'base.html' %}

{% block content %}
<div class="hero" style="padding: 40px 20px; background: linear-gradient(135deg, #28a745 0%, #20c997 100%);">
    <h1>Startup Dashboard</h1>
    <p>Welcome back, {% if startup.name %}{{ startup.name }}{% else %}{{ request.user.username }}{% endif %}!</p>
    <div style="margin-top: 15px;">
        <a href="{% url 'startup_profile' %}" class="btn" style="background: rgba(255,255,255,0.2); margin-right: 10px;">Edit Profile</a>
        <form method="post" action="{% url 'startup_logout' %}" style="display: inline;">
            {% csrf_token %}
            <button type="submit" class="btn" style="background: rgba(220,53,69,0.9); border: none; cursor: pointer;">Logout</button>
        </form>
    </div>
</div>

{% if not startup.name or not startup.niche %}
<div class="section" style="padding: 20px;">
    <div style="max-width: 800px; margin: 0 auto; background: #fff3cd; padding: 20px; border-radius: 10px; text-align: center;">
        <h3 style="color: #856404; margin: 0;">‚ö†Ô∏è Complete Your Profile</h3>
        <p style="color: #856404;">Fill in your startup details to get discovered by investors and manufacturers.</p>
        <a href="{% url 'startup_profile' %}" class="btn" style="background: #ffc107; color: #333;">Complete Profile</a>
    </div>
</div>
{% endif %}

<div class="section">
    <h2>Overview</h2>
    <div class="stats-grid">
        <div class="stat-card">
            <div class="number" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">{{ total_connections }}</div>
            <div class="label">Connection Requests</div>
        </div>
        <div class="stat-card">
            <div class="number" style="background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">{{ pending_connections }}</div>
            <div class="label">Pending Connections</div>
        </div>
        <div class="stat-card">
            <div class="number" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">{{ total_apps }}</div>
            <div class="label">Applications Sent</div>
        </div>
        <div class="stat-card">
            <div class="number" style="background: linear-gradient(135deg, #28a745 0%, #20c997 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">{{ accepted_apps }}</div>
            <div class="label">Accepted</div>
        </div>
    </div>
</div>

<div class="section">
    <h2>Quick Actions</h2>
    <div class="cards">
        <a href="{% url 'startup_profile' %}" class="card" style="text-decoration: none; color: inherit;">
            <h3>‚öôÔ∏è Edit Profile</h3>
            <p>Update your startup information, pitch, and contact details.</p>
        </a>
        <!-- new action: apply to investors -->
        <a href="{% url 'apply_to_investors' %}" class="card" style="text-decoration: none; color: inherit;">
            <h3>üì® Pitch to Investors</h3>
            <p>Select one or more investors and submit a funding request.</p>
        </a>
        <!-- application history -->
        <a href="{% url 'startup_applications_history' %}" class="card" style="text-decoration: none; color: inherit;">
            <h3>üìã Application History</h3>
            <p>View all your investment applications and their status.</p>
        </a>
        <div class="card">
            <h3>üìä Profile Status</h3>
            <p><strong>Approval:</strong> {% if startup.approved %}<span style="color: green;">‚úì Approved</span>{% else %}<span style="color: orange;">‚è≥ Pending</span>{% endif %}</p>
            <p><strong>Name:</strong> {{ startup.name|default:"Not set" }}</p>
            <p><strong>Stage:</strong> {{ startup.stage|default:"Not set" }}</p>
        </div>
    </div>
</div>

<div class="section">
    <h2>Connection Requests from Manufacturers</h2>
    {% if connection_requests %}
    <div class="cards">
        {% for req in connection_requests %}
        <div class="card">
            <h3>{{ req.manufacturer.company_name|default:req.manufacturer.user.username }}</h3>
            <p><strong>Industry:</strong> {{ req.manufacturer.industry|default:"Not specified" }}</p>
            <p><strong>Location:</strong> {{ req.manufacturer.location|default:"Not specified" }}</p>
            {% if req.message %}
            <p style="font-style: italic; color: #666;">"{{ req.message|truncatewords:20 }}"</p>
            {% endif %}
            <p><strong>Status:</strong>
                <span style="padding: 3px 10px; border-radius: 15px; font-size: 12px;
                    {% if req.status == 'ACCEPTED' %}background: #d4edda; color: #155724;
                    {% elif req.status == 'REJECTED' %}background: #f8d7da; color: #721c24;
                    {% else %}background: #fff3cd; color: #856404;{% endif %}">
                    {{ req.status }}
                </span>
            </p>
            {% if req.status == 'PENDING' %}
            <div style="margin-top: 15px; display: flex; gap: 10px;">
                <a href="{% url 'handle_connection_request' req.id 'accept' %}" class="btn" style="background: #28a745; flex: 1; text-align: center;">Accept</a>
                <a href="{% url 'handle_connection_request' req.id 'reject' %}" class="btn" style="background: #dc3545; flex: 1; text-align: center;">Reject</a>
            </div>
            {% endif %}
            {% if req.status == 'ACCEPTED' and req.manufacturer.email %}
            <div style="margin-top: 10px;">
                <a href="mailto:{{ req.manufacturer.email }}" class="btn" style="background: #17a2b8; display: block; text-align: center;">üìß Contact Manufacturer</a>
            </div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div style="text-align: center; padding: 40px;">
        <div style="font-size: 50px; margin-bottom: 15px;">ü§ù</div>
        <p style="color: #666;">No connection requests yet. Complete your profile to attract manufacturers!</p>
    </div>
    {% endif %}
</div>

{% if investment_apps %}
<div class="section">
    <h2>Investment Applications</h2>
    <div class="cards">
        {% for app in investment_apps %}
        <div class="card">
            <h3>Application to {{ app.investor.user.username }}</h3>
            {% if app.subject %}
            <p><strong>Subject:</strong> {{ app.subject }}</p>
            {% endif %}
            <p><strong>Amount Requested:</strong> ${{ app.amount_requested|floatformat:0 }}</p>
            <p><strong>Equity Offered:</strong> {{ app.equity_offered }}%</p>
            <p><strong>Status:</strong>
                <span style="padding: 3px 10px; border-radius: 15px; font-size: 12px;
                    {% if app.status == 'ACCEPTED' %}background: #d4edda; color: #155724;
                    {% elif app.status == 'REJECTED' %}background: #f8d7da; color: #721c24;
                    {% else %}background: #fff3cd; color: #856404;{% endif %}">
                    {{ app.status }}
                </span>
            </p>
        </div>
        {% endfor %}
    </div>
</div>
{% endif %}

{% endblock %}
